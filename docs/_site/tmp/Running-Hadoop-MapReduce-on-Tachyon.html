<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Running Hadoop MapReduce on Tachyon - Octopus 0.1 Documentation</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
    </style>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

    <link rel="stylesheet" href="css/pygments-default.css">

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-47563775-2', 'tachyon-project.org');
        ga('send', 'pageview');
    </script>

</head>
<body>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade
    your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install
    Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->

<!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

<div class="navbar navbar-fixed-top" id="topbar">
    <div class="navbar-inner">
        <div class="container">
            <div class="brand">
                <div style="position:absolute;">
                    <a href="index.html">
                        <img src="img/logo.png" alt="Octopus Logo" style="height:50px;"/>
                    </a>
                </div>
				<div style="float:right;margin-top:30px;">
					<span class="version">0.1</span>
				</div>
            </div>
            <ul class="nav">
                <li><a href="index.html">Overview</a></li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guides<b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="Quick-Start.html">Quick Start</a></li>
                        <li><a href="Examples.html">Examples</a></li>
                        <li><a href="ML-Library.html">ML Library</a></li>
						<li><a href="API-Docs.html">API Docs</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deploying<b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="Pre-built-Ones.html">Pre-built Ones</a></li>
						<li><a href="Running-Octopus-Locally.html">Local Mode</a></li>
						<li><a href="Running-Octopus-on-a-Cluster.html">Cluster Mode</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community<b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="FAQ.html">FAQ</a></li>
                        <li><a href="http://pasa-bigdata.nju.edu.cn:61111/jira/browse/OCT/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">JIRA</a></li>
                        <li><a href="https://groups.google.com/forum/#!forum/octopus-user">Mail List</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">More<b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="Configuration-Settings.html">Configuration Settings</a></li>
                        <li><a href="Download.html">Download</a></li>
						<li><a href="R-IDEs.html">User IDEs</a></li>
                        <li><a href="Development.html">Development</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="container" id="content">
    <h1 class="title">Running Hadoop MapReduce on Tachyon</h1>

    <p>This guide describes how to get Tachyon running with Hadoop MapReduce, so that you can easily use
your MapReduce programs with files stored on Tachyon.</p>

<h1 id="prerequisites">Prerequisites</h1>

<p>The prerequisite for this part is that you have
<a href="https://github.com/amplab/tachyon/wiki/Java-setup/">Java</a>. We also assume that you have set up
Tachyon and Hadoop in accordance to these guides <a href="Running-Tachyon-Locally.html">Local Mode</a> or
<a href="Running-Tachyon-on-a-Cluster.html">Cluster Mode</a></p>

<p>If running a Hadoop 1.x cluster, ensure that the <code>hadoop/conf/core-site.xml</code> file in your Hadoop 
installation’s conf directory has the following properties added:</p>

<pre><code>&lt;property&gt;
  &lt;name&gt;fs.tachyon.impl&lt;/name&gt;
  &lt;value&gt;tachyon.hadoop.TFS&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;fs.tachyon-ft.impl&lt;/name&gt;
  &lt;value&gt;tachyon.hadoop.TFSFT&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>This will allow your MapReduce jobs to use Tachyon for their input and output files. If you are
using HDFS as the underlying store for Tachyon, it may be necessary to add these properties to the
<code>hdfs-site.xml</code> conf file as well.</p>

<p>If the cluster is a 2.x cluster, then these properties are not needed.</p>

<h1 id="distributing-tachyon-executables">Distributing Tachyon Executables</h1>

<p>In order for the MapReduce job to be able to use files via Tachyon, we will need to distribute the
Tachyon jar amongst all the nodes in the cluster. This will allow the TaskTracker and JobClient to
have all the requisite executables to interface with Tachyon.</p>

<p>We are presented with three options that for distributing the jars as outlined by this
<a href="http://blog.cloudera.com/blog/2011/01/how-to-include-third-party-libraries-in-your-map-reduce-job/">guide</a>
from Cloudera.</p>

<p>Assuming that Tachyon will be used prominently, it is best to ensure that the Tachyon jar will
permanently reside on each node, so that we do not rely on the Hadoop DistributedCache to avoid the
network costs of distributing the jar for each job (Option 1), and don’t significantly increase our
job jar size by packaging Tachyon with it (Option 2). For this reason, of the three options laid
out, it is highly recommended to consider the third route, by installing the Tachyon jar on each
node.</p>

<ul>
  <li>
    <p>For installing Tachyon on each node, you must place the
<code>tachyon-client-0.5.0-jar-with-dependencies.jar</code>, located in the
<code>tachyon/client/target</code> directory, in the <code>$HADOOP_HOME/lib</code> directory of each node, and then
restart all of the TaskTrackers. One downfall of this approach is that the jars must be
installed again for each update to a new release.</p>
  </li>
  <li>
    <p>You can also run a job by using the <code>-libjars</code> command line option when using <code>hadoop jar...</code>, and
specifying
<code>/pathToTachyon/core/target/tachyon-client=0.5.0-jar-with-dependencies.jar</code>
as the argument. This will place the jar in the Hadoop DistributedCache, and is desirable only
if you are updating the Tachyon jar a non-trivial number of times.</p>
  </li>
  <li>
    <p>For those interested in the second option, please revisit the Cloudera guide for more assistance.
One must simply package the Tachyon jar in the <code>lib</code> subdirectory of the job jar. This option is
the most undesirable since for every change in Tachyon, we must recreate the job jar, thereby
incurring a network cost for every job by increasing the size of the job jar.</p>
  </li>
</ul>

<p>In order to make the Tachyon executables available to the JobClient, one can also install the
Tachyon jar in the <code>$HADOOP_HOME/lib</code> directory, or modify <code>HADOOP_CLASSPATH</code> by changing <code>hadoop-env.sh</code> to:</p>

<pre><code>$ export HADOOP_CLASSPATH=/pathToTachyon/client/target/tachyon-client-0.5.0-jar-with-dependencies.jar
</code></pre>

<p>This will allow the code that creates the Job and submits it to reference Tachyon if necessary.</p>

<h1 id="example">Example</h1>

<p>For simplicity, we will assume a psuedo-distributed Hadoop cluster.</p>

<pre><code>$ cd $HADOOP_HOME
$ ./bin/stop-all.sh
$ ./bin/start-all.sh
</code></pre>

<p>Because we have a psuedo-distributed cluster, copying the Tachyon jar into <code>$HADOOP_HOME/lib</code> makes
the Tachyon executables available to both the TaskTrackers and the JobClient. We can now verify that
it is working by the following:</p>

<pre><code>$ cd $HADOOP_HOME
$ ./bin/hadoop jar hadoop-examples-1.0.4.jar wordcount -libjars /pathToTachyon/client/target/tachyon-client-0.5.0-jar-with-dependencies.jar tachyon://localhost:19998/X tachyon://localhost:19998/X-wc
</code></pre>

<p>Where X is some file on Tachyon and, the results of the wordcount job is in the X-wc directory.</p>

<p>For example, say you have text files in HDFS directory <code>/user/hduser/gutenberg/</code>. You can run the
following:</p>

<pre><code>$ cd $HADOOP_HOME
$ ./bin/hadoop jar hadoop-examples-1.0.4.jar wordcount -libjars /pathToTachyon/client/target/tachyon-client-0.5.0-jar-with-dependencies.jar tachyon://localhost:19998/user/hduser/gutenberg tachyon://localhost:19998/user/hduser/output
</code></pre>

<p>The above command tell the wordcount to load the files from HDFS directory <code>/user/hduser/gutenberg/</code>
into Tachyon and then save the output result to <code>/user/hduser/output/</code> in Tachyon.</p>

    <!-- Main hero unit for a primary marketing message or call to action -->
    <!--<div class="hero-unit">
        <h1>Hello, world!</h1>
        <p>This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
        <p><a class="btn btn-primary btn-large">Learn more &raquo;</a></p>
            </div>-->

    <!-- Example row of columns -->
    <!--<div class="row">
        <div class="span4">
            <h2>Heading</h2>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
            <p><a class="btn" href="#">View details &raquo;</a></p>
                </div>
                <div class="span4">
                    <h2>Heading</h2>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                    <p><a class="btn" href="#">View details &raquo;</a></p>
               </div>
                <div class="span4">
                    <h2>Heading</h2>
                    <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
                    <p><a class="btn" href="#">View details &raquo;</a></p>
                </div>
            </div>

            <hr>-->

    <footer>
        <hr>
        <p style="text-align: center; veritcal-align: middle; color: #999;">
            Octopus is a project developed at the Nanjing University
            <a href="http://pasa-bigdata.nju.edu.cn/">
                PASALab.
            </a> All Rights Reserved.
        </p>
    </footer>

</div>
<!-- /container -->

<script src="js/vendor/jquery-1.8.0.min.js"></script>
<script src="js/vendor/bootstrap.min.js"></script>
<script src="js/main.js"></script>

<!-- A script to fix internal hash links because we have an overlapping top bar.
     Based on https://github.com/twitter/bootstrap/issues/193#issuecomment-2281510 -->
<script>
    $(function () {
        function maybeScrollToHash() {
            if (window.location.hash && $(window.location.hash).length) {
                var newTop = $(window.location.hash).offset().top - $('#topbar').height() - 5;
                $(window).scrollTop(newTop);
            }
        }

        $(window).bind('hashchange', function () {
            maybeScrollToHash();
        });
        // Scroll now too in case we had opened the page on a hash, but wait 1 ms because some browsers
        // will try to do *their* initial scroll after running the onReady handler.
        setTimeout(function () {
            maybeScrollToHash();
        }, 1)
    })
</script>

</body>
</html>
